# Maplefile for Bittree

# Commands for building local image and
# installing dependencies
build = [
    "export TZ=US/Michigan",
    "ln -snf /usr/share/zoneinfo/$TZ /etc/localtime && echo $TZ > /etc/timezone",
    "apt-get update -y && apt-get install -y apt-utils && apt-get upgrade -y",
    "apt-get install -y git libhdf5-openmpi-dev openmpi-bin",
    "apt-get install -y python3 python3-dev python3-pip",
    "apt-get install -y python-is-python3",
]

# Name of the local container that will be used
# to run/modify the image
# Note: 'container' is a writable instance of an 'image'
container = "bittree"

# Commands to execute inside the container and update the
# image
publish = [
    "git config --global --add safe.directory /home/mount",
    "python3 setup.py library --dim 2 --prefix tmp_install",
    "cd build && make && make install",
    "mkdir -p /home/lib/bittree/2D",
    "cp -r tmp_install/* /home/lib/bittree/2D",
]

# Backend for service docker/singularity
backend = "docker"
